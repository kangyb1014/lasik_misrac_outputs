{
  "user_message": "An agent A claimed that the following metal_default_log_handler code violates the MISRA C 2023 rule 17.8.\n<misra_rule>\nMISRA C 2023 Rule 17.8 is A function parameter should not be modified.\nNote that the object referred to by a pointer parameter may be modified, but the pointer itself shall not be modified.\n</misra_rule>\n<target_code>\nHere is the original code of metal_default_log_handler.\n```c\nvoid metal_default_log_handler(enum metal_log_level level,\n\t\t\t       const char *format, ...)\n{\n#ifdef DEFAULT_LOGGER_ON\n\tchar msg[1024];\n\tva_list args;\n\tstatic const char * const level_strs[] = {\n\t\t\"metal: emergency: \",\n\t\t\"metal: alert:     \",\n\t\t\"metal: critical:  \",\n\t\t\"metal: error:     \",\n\t\t\"metal: warning:   \",\n\t\t\"metal: notice:    \",\n\t\t\"metal: info:      \",\n\t\t\"metal: debug:     \",\n\t};\n\n\tva_start(args, format);\n\tvsnprintf(msg, sizeof(msg), format, args);\n\tva_end(args);\n\n\tif (level <= METAL_LOG_EMERGENCY || level > METAL_LOG_DEBUG)\n\t\tlevel = METAL_LOG_EMERGENCY;\n\n\tfprintf(stderr, \"%s%s\", level_strs[level], msg);\n#else\n\t(void)level;\n\t(void)format;\n#endif\n}\n```\n</target_code>\n<response format>\nProvide your answer with these fields.\n- explanation: your evaluation of the scenario provided by the agent A.\n- is_report_correct: whether the report is correct or not (true/false). True means there is a violation.\n</response format>\n<scenario>\nThe agent A provided the following violation scenario:\nThe code assigns to the parameter 'level' (level = METAL_LOG_EMERGENCY;), which modifies a function parameter passed by value. This violates MISRA C 2023 Rule 17.8. Fix by using a local variable (e.g. enum metal_log_level lvl = level; then modify lvl) or perform the range check without assigning to the parameter.\n</scenario>\n\n<execution_log>\nThe agent A also provided the following output log:\nENTER metal_default_log_handler: level=7, format=0x7f4d9c106a46\nformatted msg='added page size 4096 @/tmp\n'\nlevel UNCHANGED: 7\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=4, format=0x7f4d9c106a20\nformatted msg='skipped page size 2097152 - invalid args\n'\nlevel UNCHANGED: 4\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=4, format=0x7f4d9c106a20\nformatted msg='skipped page size 1073741824 - invalid args\n'\nlevel UNCHANGED: 4\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=7, format=0x7f4d9c106050\nformatted msg='registered platform bus\n'\nlevel UNCHANGED: 7\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=7, format=0x7f4d9c106050\nformatted msg='registered pci bus\n'\nlevel UNCHANGED: 7\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae6675f3\nformatted msg='running [atomic]\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=4, format=0x7f4d9c106be0\nformatted msg='metal_linux_irq_handling: Failed to set scheduler: Unknown error -1.\n'\nlevel UNCHANGED: 4\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae667617\nformatted msg='result [atomic]............................ pass\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae6675f3\nformatted msg='running [mutex]\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae667617\nformatted msg='result [mutex]............................. pass\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae6675f3\nformatted msg='running [shmem]\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae667617\nformatted msg='result [shmem]............................. pass\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae6675f3\nformatted msg='running [condition]\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae667617\nformatted msg='result [condition]......................... pass\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae6675f3\nformatted msg='running [spinlock]\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae667617\nformatted msg='result [spinlock].......................... pass\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae6675f3\nformatted msg='running [alloc]\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae667617\nformatted msg='result [alloc]............................. pass\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae6675f3\nformatted msg='running [irq]\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae667617\nformatted msg='result [irq]............................... pass\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae6675f3\nformatted msg='running [version]\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=6, format=0x562dae667617\nformatted msg='result [version]........................... pass\n'\nlevel UNCHANGED: 6\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=7, format=0x7f4d9c106cda\nformatted msg='metal_linux_irq_shutdown\n'\nlevel UNCHANGED: 7\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=7, format=0x7f4d9c106063\nformatted msg='unregistered platform bus\n'\nlevel UNCHANGED: 7\nEXIT metal_default_log_handler\n\nENTER metal_default_log_handler: level=7, format=0x7f4d9c106063\nformatted msg='unregistered pci bus\n'\nlevel UNCHANGED: 7\nEXIT\n</execution_log>\n<additional code>Here are the definitions of symbols that are close to the target function metal_default_log_handler:\nenum metal_log_level {\n\tMETAL_LOG_EMERGENCY,\t/**< system is unusable.               */\n\tMETAL_LOG_ALERT,\t/**< action must be taken immediately. */\n\tMETAL_LOG_CRITICAL,\t/**< critical conditions.              */\n\tMETAL_LOG_ERROR,\t/**< error conditions.                 */\n\tMETAL_LOG_WARNING,\t/**< warning conditions.               */\n\tMETAL_LOG_NOTICE,\t/**< normal but significant condition. */\n\tMETAL_LOG_INFO,\t\t/**< informational messages.           */\n\tMETAL_LOG_DEBUG,\t/**< debug-level messages.             */\n}\n</additional code>\n\n<instruction>\nJudge whether the report is correct or not.\n</instruction>\n",
  "is_report_correct": true,
  "explanation": "Agent A is correct. The parameter 'level' is a value parameter (enum metal_log_level) and the function assigns to it (level = METAL_LOG_EMERGENCY;). MISRA C 2023 Rule 17.8 forbids modifying function parameters; the allowance in the rule applies only to the objects referred to by pointer parameters, not to by-value parameters. The execution log showing the caller's variable unchanged is irrelevant because the parameter is passed by value; MISRA concerns the local parameter object being modified. Fixes: use a local copy (e.g. enum metal_log_level lvl = level; and modify lvl) or compute an index/conditional result without assigning to the parameter."
}