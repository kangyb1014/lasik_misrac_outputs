{
  "user_message": "An agent A claimed that the following ahc_echo code violates the MISRA C 2023 rule 21.14.\n<misra_rule>\nMISRA C 2023 Rule 21.14 is The Standard Library function memcmp shall not be used to compare null terminated strings.\n.\n</misra_rule>\n<target_code>\nHere is the original code of ahc_echo.\n```c\nstatic enum MHD_Result\nahc_echo (void *cls,\n          struct MHD_Connection *connection,\n          const char *url,\n          const char *method,\n          const char *version,\n          const char *upload_data, size_t *upload_data_size, void **req_cls)\n{\n  static int aptr;\n  struct MHD_Response *response;\n  enum MHD_Result ret;\n  struct MHD_BasicAuthInfo *auth_info;\n  int fail;\n  (void) cls;               /* Unused. Silent compiler warning. */\n  (void) url;               /* Unused. Silent compiler warning. */\n  (void) version;           /* Unused. Silent compiler warning. */\n  (void) upload_data;       /* Unused. Silent compiler warning. */\n  (void) upload_data_size;  /* Unused. Silent compiler warning. */\n\n  if (0 != strcmp (method, \"GET\"))\n    return MHD_NO;              /* unexpected method */\n  if (&aptr != *req_cls)\n  {\n    /* do never respond on first call */\n    *req_cls = &aptr;\n    return MHD_YES;\n  }\n  *req_cls = NULL;                  /* reset when done */\n\n  /* require: \"Aladdin\" with password \"open sesame\" */\n  auth_info = MHD_basic_auth_get_username_password3 (connection);\n  fail = ( (NULL == auth_info) ||\n           (strlen (\"Aladdin\") != auth_info->username_len) ||\n           (0 != memcmp (auth_info->username, \"Aladdin\",\n                         auth_info->username_len)) ||\n           /* The next check against NULL is optional,\n            * if 'password' is NULL then 'password_len' is always zero. */\n           (NULL == auth_info->password) ||\n           (strlen (\"open sesame\") != auth_info->password_len) ||\n           (0 != memcmp (auth_info->password, \"open sesame\",\n                         auth_info->password_len)) );\n  if (fail)\n  {\n    response =\n      MHD_create_response_from_buffer_static (strlen (DENIED),\n                                              (const void *) DENIED);\n    ret = MHD_queue_basic_auth_required_response3 (connection,\n                                                   \"TestRealm\",\n                                                   MHD_NO,\n                                                   response);\n  }\n  else\n  {\n    response =\n      MHD_create_response_from_buffer_static (strlen (PAGE),\n                                              (const void *) PAGE);\n    ret = MHD_queue_response (connection, MHD_HTTP_OK, response);\n  }\n  if (NULL != auth_info)\n    MHD_free (auth_info);\n  MHD_destroy_response (response);\n  return ret;\n}\n```\n</target_code>\n<scenario>\nThe agent A provided the following violation scenario:Using the standard library function memcmp to compare user credentials (username and password) against string literals that are null terminated strings violates MISRA C 2023 Rule 21.14.\n</scenario>\n<test_code>\nAlso, the agent A provided the following modified code that prints out the log to support their scenario:\n```c\n\nstatic enum MHD_Result\nahc_echo (void *cls,\n          struct MHD_Connection *connection,\n          const char *url,\n          const char *method,\n          const char *version,\n          const char *upload_data, size_t *upload_data_size, void **req_cls)\n{\n  static int aptr;\n  struct MHD_Response *response;\n  enum MHD_Result ret;\n  struct MHD_BasicAuthInfo *auth_info;\n  int fail;\n  FILE *log_file = fopen(\"/tmp/logs/534.txt\", \"a\");\n\n  (void) cls;               /* Unused. Silent compiler warning. */\n  (void) url;               /* Unused. Silent compiler warning. */\n  (void) version;           /* Unused. Silent compiler warning. */\n  (void) upload_data;       /* Unused. Silent compiler warning. */\n  (void) upload_data_size;  /* Unused. Silent compiler warning. */\n\n  if (0 != strcmp (method, \"GET\"))\n  {\n    if (log_file)\n      fprintf(log_file, \"method is not GET, returning MHD_NO\\n\");\n    if (log_file) fclose(log_file);\n    return MHD_NO;              /* unexpected method */\n  }\n\n  if (&aptr != *req_cls)\n  {\n    if (log_file)\n      fprintf(log_file, \"First call, not responding yet\\n\");\n    *req_cls = &aptr;\n    if (log_file) fclose(log_file);\n    return MHD_YES;\n  }\n\n  *req_cls = NULL;                  /* reset when done */\n\n  auth_info = MHD_basic_auth_get_username_password3 (connection);\n\n  if (log_file) {\n    fprintf(log_file, \"Checking authentication info...\\n\");\n    if (auth_info != NULL) {\n      fprintf(log_file, \"Username length: %zu, Password length: %zu\\n\", auth_info->username_len, auth_info->password_len);\n    } else {\n      fprintf(log_file, \"auth_info is NULL\\n\");\n    }\n  }\n\n  fail = ( (NULL == auth_info) ||\n           (strlen (\"Aladdin\") != auth_info->username_len) ||\n           (0 != memcmp (auth_info->username, \"Aladdin\",\n                         auth_info->username_len)) ||\n           (NULL == auth_info->password) ||\n           (strlen (\"open sesame\") != auth_info->password_len) ||\n           (0 != memcmp (auth_info->password, \"open sesame\",\n                         auth_info->password_len)) );\n\n  if (log_file) {\n    fprintf(log_file, \"Authentication %s\\n\", fail ? \"failed\" : \"succeeded\");\n  }\n\n  if (fail)\n  {\n    response =\n      MHD_create_response_from_buffer_static (strlen (DENIED),\n                                              (const void *) DENIED);\n    ret = MHD_queue_basic_auth_required_response3 (connection,\n                                                   \"TestRealm\",\n                                                   MHD_NO,\n                                                   response);\n    if (log_file) fprintf(log_file, \"Sent access denied response\\n\");\n  }\n  else\n  {\n    response =\n      MHD_create_response_from_buffer_static (strlen (PAGE),\n                                              (const void *) PAGE);\n    ret = MHD_queue_response (connection, MHD_HTTP_OK, response);\n    if (log_file) fprintf(log_file, \"Sent OK response\\n\");\n  }\n\n  if (NULL != auth_info)\n    MHD_free (auth_info);\n  MHD_destroy_response (response);\n\n  if (log_file) fclose(log_file);\n\n  return ret;\n}\n\n```\nThe test code failed to compile, so we could not obtain any output.\n\n</test_code>\n<response format>\nProvide your answer with these fields.\n- explanation: your evaluation of the scenario provided by the agent A.\n- is_report_correct: whether the report is correct or not (true/false)\n</response format>\n<instruction>   \nJudge whether the report is correct or not.\n</instruction>\n",
  "is_report_correct": true,
  "explanation": "MISRA C 2023 Rule 21.14 prohibits using the Standard Library function memcmp to compare null terminated strings. The code uses memcmp to compare the username and password stored in auth_info against string literals \"Aladdin\" and \"open sesame\". However, these comparisons use memcmp with an explicit length parameter equal to the length of the string literals (obtained via strlen) and lengths stored in auth_info. This effectively compares a fixed number of characters, not null terminated strings per se. Yet, the strings \"Aladdin\" and \"open sesame\" are null terminated strings (string literals). Using memcmp in this way is not safe under MISRA C 2023 because memcmp is intended for binary comparison of memory blocks, not for strings which can contain termination characters. The rule explicitly forbids using memcmp to compare null terminated strings, even if length parameters are provided, because memcmp doesn't guarantee to stop at a null character and can cause logic errors if applied on strings. Instead, string comparison functions like strcmp or strncmp should be used for null terminated strings. Therefore, the claim that using memcmp to compare user credentials (null terminated strings) against string literals violates MISRA C 2023 Rule 21.14 is correct. The agent's report is valid. The modified test code failing to compile does not invalidate the correctness of the rule violation claim regarding the usage of memcmp for strings."
}